services:
  postgres:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  hapi-fhir:
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "1.0"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  keycloak-postgres:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  keycloak:
    command: start
    restart: unless-stopped
    environment:
      KC_HOSTNAME: ${KC_HOSTNAME}
      KC_PROXY_HEADERS: xforwarded
    deploy:
      resources:
        limits:
          memory: 1g
          cpus: "0.5"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  fhirhub-api:
    image: ${DOCKERHUB_USERNAME}/fhirhub-api:${IMAGE_TAG:-latest}
    build: !reset null
    restart: unless-stopped
    environment:
      ASPNETCORE_ENVIRONMENT: Production
    deploy:
      resources:
        limits:
          memory: 512m
          cpus: "0.5"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  fhirhub-frontend:
    image: ${DOCKERHUB_USERNAME}/fhirhub-frontend:${IMAGE_TAG:-latest}
    build: !reset null
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 256m
          cpus: "0.25"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
