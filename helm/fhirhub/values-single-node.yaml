# Single-node k3s deployment values
# Usage: helm install fhirhub helm/fhirhub -f helm/fhirhub/values-single-node.yaml
#
# Designed for a single machine with 4 CPU / 8GB RAM / 100GB disk.
# Key differences from multi-node:
#   - All replicas = 1
#   - HPA disabled (no scaling on single node)
#   - PDB disabled (meaningless with 1 pod)
#   - className: traefik (k3s bundles Traefik, not nginx)
#   - storageClass: local-path (k3s built-in provisioner)
#   - Reduced resource limits to fit 8GB total

global:
  domain: fhirhub.local
  storageClass: local-path

# PostgreSQL for HAPI FHIR
hapi-postgresql:
  persistence:
    size: 5Gi
    storageClass: local-path
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# PostgreSQL for Keycloak
keycloak-postgresql:
  persistence:
    size: 2Gi
    storageClass: local-path
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# HAPI FHIR Server
hapi-fhir:
  replicaCount: 1
  hpa:
    enabled: false
  resources:
    requests:
      cpu: 200m
      memory: 768Mi
    limits:
      cpu: "1"
      memory: 1.5Gi

# Keycloak
keycloak:
  replicaCount: 1
  resources:
    requests:
      cpu: 200m
      memory: 384Mi
    limits:
      cpu: 500m
      memory: 768Mi
  ingress:
    enabled: true
    className: traefik
    tls: []
    hosts:
      - host: auth.fhirhub.local
        paths:
          - path: /
            pathType: Prefix

# FhirHub API
fhirhub-api:
  replicaCount: 1
  ingress:
    enabled: true
    className: traefik
    tls: []
    hosts:
      - host: fhirhub.local
        paths:
          - path: /api(/|$)(.*)
            pathType: ImplementationSpecific
  hpa:
    enabled: false
  pdb:
    enabled: false
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  serviceMonitor:
    enabled: true

# FhirHub Frontend
fhirhub-frontend:
  replicaCount: 1
  ingress:
    enabled: true
    className: traefik
    tls: []
    hosts:
      - host: fhirhub.local
        paths:
          - path: /
            pathType: Prefix
  hpa:
    enabled: false
  pdb:
    enabled: false
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi
  serviceMonitor:
    enabled: true
